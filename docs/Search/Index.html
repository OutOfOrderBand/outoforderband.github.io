<!DOCTYPE html>
<head>
  <meta charset="UTF-8" />
</head>

<title> HCC Acronym Finder </title>
<meta
  name="Keywords"
  content=""
/>
<meta
  name="Description"
  content=""
/>

<meta name="robots" content="noindex">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1"
/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="./main.css" />

<script
  src="https://cdnjs.cloudflare.com/ajax/libs/fuzzysort/2.0.1/fuzzysort.js"
  integrity="sha512-bCDA/jJ0gZxk5wVX5rBrkFoHWSlebAmIl8TsFDlLwdD5IjkxpEs4v4D3ym2GuwYfTdBsTyHnM0VTcn30TWS4vw=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
></script>

<script
  src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.37/vue.global.prod.min.js"
  integrity="sha512-8GokEWxcB/NrPU4O8BHTgd9dkLouAsvqCnk6BSa2CZw7QXh0QM8GHfS53xYW1QJJVyJWctlcdRQwu5UxeLVsNA=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
></script>

<script src="./HCCACData.js"></script>

<div id="vue" class="jumbotron" style="background: none">
  <div class="container" style="max-width: 720px">
    <!-- hccdatakeys -->
    <h1>HCC Acronym Finder</h1>
    <br />
    <br />

    <!-- input -->
    <div class="acronym-input-div" style="width: 100%">
      <input
        id="input"
        class="acronym-input"
        autofocus
        style="width: 100%"
        v-model="input"
        :placeholder="hccdatakey"
        :data-empty="!input"
        @input="search"
      />
      <hr class="acronym-input-hr" />
    </div>

    <!-- results -->
    <div id="results">
      <p v-if="results.length">{{results.total}} matches in {{duration}}ms</p>
      <ul style="list-style: none">
        <li v-for="result of results" v-html="renderResult(result)"></li>
      </ul>
    </div>
  </div>
</div>

<script>
  // config
  const config = {
    fuzzyoptions: {
      limit: 100,
    },
    benchtime: 250,
    // benchtime: 1000,
  };

  // fuzzysort.new
  const _fuzzysort = fuzzysort;
  fuzzysort.new = function (instanceOptions) {
    return {
      ..._fuzzysort,
      go: (s, t, o) => _fuzzysort.go(s, t, { ...instanceOptions, ...o }),
    };
  };

  // apply config.fuzzyoptions
  fuzzysort = fuzzysort.new(config.fuzzyoptions);

  // load hccdata into hccdata_prepared, hccdata_obj
  let hccdata_prepared = {},
    hccdata_obj = {};
  {
    for (const key of Object.keys(hccdata)) {
      hccdata_prepared[key] = new Array(hccdata[key].length);
      for (let i = hccdata[key].length - 1; i >= 0; i -= 1) {
        hccdata_prepared[key][i] = fuzzysort.prepare(hccdata[key][i]);
      }
    }
    for (const key of Object.keys(hccdata)) {
      hccdata_obj[key] = new Array(hccdata[key].length);
      for (let i = hccdata[key].length - 1; i >= 0; i -= 1) {
        hccdata_obj[key][i] = {
          str: hccdata[key][i],
          prepared: hccdata_prepared[key][i],
        };
      }
    }
  }
</script>

<script>
  (function () {
    var vue = (window.vue = Vue.createApp({
      data() {
        return {
          hccdatakeys: Object.keys(hccdata_prepared),
          hccdatakey: "HCC Acronyms",

          input: "",
          results: [],
          duration: 0,
        };
      },

      methods: {
        renderResult: (result) => `${fuzzysort.highlight(result)}`,
        search() {
          document.getElementById("input").focus();

          const startms = getms();
          vue.results = fuzzysort.go(
            vue.input.toLowerCase(),
            hccdata_prepared[vue.hccdatakey]
          );
        },
      },
    }).mount("#vue"));

    function getms() {
      return performance.now();
    }

    document.body.onload = () => {
      const $input = document.getElementById("input");
      document.onkeyup = (e) => {
        if (e.key == "Escape") $input.select();
      };
      document.onkeydown = (e) => $input.focus();
      vue.search();
    };
  })();
</script>
